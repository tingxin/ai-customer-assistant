# æ™ºèƒ½å®¢æœç³»ç»Ÿå®æ–½æ‰‹å†Œ\n\n## 1. ç¯å¢ƒå‡†å¤‡\n\n### 1.1 ç³»ç»Ÿè¦æ±‚\n- **æ“ä½œç³»ç»Ÿ**ï¼šLinux (Ubuntu 20.04+) / macOS / Windows 10+\n- **Pythonç‰ˆæœ¬**ï¼š3.11+\n- **Node.jsç‰ˆæœ¬**ï¼š18+\n- **å†…å­˜è¦æ±‚**ï¼šæœ€ä½8GBï¼Œæ¨è16GB+\n- **å­˜å‚¨ç©ºé—´**ï¼šæœ€ä½50GBå¯ç”¨ç©ºé—´\n- **ç½‘ç»œè¦æ±‚**ï¼šç¨³å®šçš„äº’è”ç½‘è¿æ¥ï¼ˆç”¨äºä¸‹è½½ä¾èµ–å’ŒAIæ¨¡å‹ï¼‰\n\n### 1.2 ä¾èµ–è½¯ä»¶å®‰è£…\n\n#### 1.2.1 å®‰è£…Dockerå’ŒDocker Compose\n```bash\n# Ubuntu/Debian\nsudo apt update\nsudo apt install docker.io docker-compose-plugin\nsudo usermod -aG docker $USER\n\n# macOS (ä½¿ç”¨Homebrew)\nbrew install docker docker-compose\n\n# éªŒè¯å®‰è£…\ndocker --version\ndocker compose version\n```\n\n#### 1.2.2 å®‰è£…Pythonå’ŒNode.js\n```bash\n# å®‰è£…Python 3.11\nsudo apt install python3.11 python3.11-venv python3.11-dev\n\n# å®‰è£…Node.js 18\ncurl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -\nsudo apt-get install -y nodejs\n\n# éªŒè¯å®‰è£…\npython3.11 --version\nnode --version\nnpm --version\n```\n\n## 2. é¡¹ç›®åˆå§‹åŒ–\n\n### 2.1 åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„\n```bash\n# åˆ›å»ºé¡¹ç›®æ ¹ç›®å½•\nmkdir ai-customer-service\ncd ai-customer-service\n\n# åˆ›å»ºå­ç›®å½•\nmkdir -p backend/app/{api,services,models,knowledge}\nmkdir -p frontend/src/{components,pages,services}\nmkdir -p docs\nmkdir -p data/{uploads,vectors,logs}\nmkdir -p scripts\n\n# åˆ›å»ºå¿…è¦çš„ç©ºæ–‡ä»¶\ntouch backend/app/__init__.py\ntouch backend/requirements.txt\ntouch frontend/package.json\ntouch docker-compose.yml\ntouch .env\ntouch README.md\n```\n\n### 2.2 é…ç½®ç¯å¢ƒå˜é‡\nåˆ›å»º `.env` æ–‡ä»¶ï¼š\n```bash\n# æ•°æ®åº“é…ç½®\nPOSTGRES_DB=ai_customer_service\nPOSTGRES_USER=postgres\nPOSTGRES_PASSWORD=your_secure_password\nPOSTGRES_HOST=localhost\nPOSTGRES_PORT=5432\n\n# Redisé…ç½®\nREDIS_URL=redis://localhost:6379\n\n# AIæ¨¡å‹é…ç½®\nOPENAI_API_KEY=your_openai_api_key\nEMBEDDING_MODEL=all-MiniLM-L6-v2\n\n# åº”ç”¨é…ç½®\nSECRET_KEY=your_secret_key_here\nDEBUG=true\nFRONTEND_URL=http://localhost:3000\nBACKEND_URL=http://localhost:8000\n\n# æ–‡ä»¶å­˜å‚¨\nUPLOAD_DIR=./data/uploads\nVECTOR_DIR=./data/vectors\nLOG_DIR=./data/logs\n```\n\n## 3. åç«¯å®æ–½æ­¥éª¤\n\n### 3.1 åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ\n```bash\ncd backend\npython3.11 -m venv venv\nsource venv/bin/activate  # Linux/macOS\n# venv\\Scripts\\activate  # Windows\n```\n\n### 3.2 å®‰è£…Pythonä¾èµ–\nåˆ›å»º `backend/requirements.txt`ï¼š\n```\n# Webæ¡†æ¶\nfastapi==0.104.1\nuvicorn[standard]==0.24.0\npython-multipart==0.0.6\n\n# æ•°æ®å¤„ç†\npydantic==2.5.0\npydantic-settings==2.1.0\nsqlalchemy==2.0.23\npsycopg2-binary==2.9.9\nredis==5.0.1\n\n# AIå’Œå‘é‡å¤„ç†\nrag-anything==0.1.0\nlightrag==0.1.0\nchromadb==0.4.15\nsentence-transformers==2.2.2\ntransformers==4.35.0\ntorch==2.1.0\n\n# æ–‡æ¡£å¤„ç†\nPyPDF2==3.0.1\npython-docx==0.8.11\nmarkdown==3.5.1\nbeautifulsoup4==4.12.2\n\n# å·¥å…·åº“\naiofiles==23.2.1\npython-jose[cryptography]==3.3.0\npasslib[bcrypt]==1.7.4\n```\n\nå®‰è£…ä¾èµ–ï¼š\n```bash\npip install -r requirements.txt\n```\n\n### 3.3 åˆ›å»ºåç«¯æ ¸å¿ƒæ–‡ä»¶\n\n#### 3.3.1 åˆ›å»ºä¸»åº”ç”¨æ–‡ä»¶\nåˆ›å»º `backend/app/main.py`ï¼š\n```python\nfrom fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom fastapi.staticfiles import StaticFiles\nfrom app.api.v1 import chat, knowledge, admin\nfrom app.core.config import settings\n\napp = FastAPI(\n    title=\"æ™ºèƒ½å®¢æœç³»ç»ŸAPI\",\n    description=\"åŸºäºRAGæŠ€æœ¯çš„æ™ºèƒ½å®¢æœç³»ç»Ÿ\",\n    version=\"1.0.0\"\n)\n\n# CORSé…ç½®\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=settings.ALLOWED_ORIGINS,\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# é™æ€æ–‡ä»¶æœåŠ¡\napp.mount(\"/uploads\", StaticFiles(directory=settings.UPLOAD_DIR), name=\"uploads\")\n\n# æ³¨å†Œè·¯ç”±\napp.include_router(chat.router, prefix=\"/api/v1/chat\", tags=[\"chat\"])\napp.include_router(knowledge.router, prefix=\"/api/v1/knowledge\", tags=[\"knowledge\"])\napp.include_router(admin.router, prefix=\"/api/v1/admin\", tags=[\"admin\"])\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"æ™ºèƒ½å®¢æœç³»ç»ŸAPIæœåŠ¡æ­£åœ¨è¿è¡Œ\", \"version\": \"1.0.0\"}\n\n@app.get(\"/health\")\nasync def health_check():\n    return {\"status\": \"healthy\", \"service\": \"ai-customer-service\"}\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(\n        \"app.main:app\",\n        host=\"0.0.0.0\",\n        port=8000,\n        reload=settings.DEBUG\n    )\n```\n\n#### 3.3.2 åˆ›å»ºé…ç½®æ–‡ä»¶\nåˆ›å»º `backend/app/core/config.py`ï¼š\n```python\nfrom pydantic_settings import BaseSettings\nfrom typing import List\nimport os\n\nclass Settings(BaseSettings):\n    # æ•°æ®åº“é…ç½®\n    POSTGRES_DB: str = \"ai_customer_service\"\n    POSTGRES_USER: str = \"postgres\"\n    POSTGRES_PASSWORD: str = \"password\"\n    POSTGRES_HOST: str = \"localhost\"\n    POSTGRES_PORT: int = 5432\n    \n    @property\n    def DATABASE_URL(self) -> str:\n        return f\"postgresql://{self.POSTGRES_USER}:{self.POSTGRES_PASSWORD}@{self.POSTGRES_HOST}:{self.POSTGRES_PORT}/{self.POSTGRES_DB}\"\n    \n    # Redisé…ç½®\n    REDIS_URL: str = \"redis://localhost:6379\"\n    \n    # AIé…ç½®\n    OPENAI_API_KEY: str = \"\"\n    EMBEDDING_MODEL: str = \"all-MiniLM-L6-v2\"\n    \n    # åº”ç”¨é…ç½®\n    SECRET_KEY: str = \"your-secret-key-change-in-production\"\n    DEBUG: bool = True\n    ALLOWED_ORIGINS: List[str] = [\"http://localhost:3000\"]\n    \n    # æ–‡ä»¶å­˜å‚¨\n    UPLOAD_DIR: str = \"./data/uploads\"\n    VECTOR_DIR: str = \"./data/vectors\"\n    LOG_DIR: str = \"./data/logs\"\n    \n    # ç¡®ä¿ç›®å½•å­˜åœ¨\n    def __init__(self, **kwargs):\n        super().__init__(**kwargs)\n        os.makedirs(self.UPLOAD_DIR, exist_ok=True)\n        os.makedirs(self.VECTOR_DIR, exist_ok=True)\n        os.makedirs(self.LOG_DIR, exist_ok=True)\n    \n    class Config:\n        env_file = \".env\"\n\nsettings = Settings()\n```\n\n### 3.4 åˆ›å»ºæ•°æ®åº“æ¨¡å‹\nåˆ›å»º `backend/app/models/database.py`ï¼š\n```python\nfrom sqlalchemy import create_engine, Column, String, DateTime, Text, Integer, Boolean\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker\nfrom sqlalchemy.dialects.postgresql import UUID\nfrom datetime import datetime\nimport uuid\nfrom app.core.config import settings\n\nengine = create_engine(settings.DATABASE_URL)\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\nBase = declarative_base()\n\nclass User(Base):\n    __tablename__ = \"users\"\n    \n    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)\n    username = Column(String(50), unique=True, nullable=False)\n    email = Column(String(100), unique=True)\n    password_hash = Column(String(255))\n    role = Column(String(20), default=\"user\")\n    is_active = Column(Boolean, default=True)\n    created_at = Column(DateTime, default=datetime.utcnow)\n    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n\nclass Session(Base):\n    __tablename__ = \"sessions\"\n    \n    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)\n    user_id = Column(UUID(as_uuid=True), nullable=True)\n    title = Column(String(200))\n    status = Column(String(20), default=\"active\")\n    created_at = Column(DateTime, default=datetime.utcnow)\n    last_activity = Column(DateTime, default=datetime.utcnow)\n\nclass Message(Base):\n    __tablename__ = \"messages\"\n    \n    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)\n    session_id = Column(UUID(as_uuid=True), nullable=False)\n    sender_type = Column(String(10), nullable=False)  # 'user', 'ai', 'admin'\n    content = Column(Text, nullable=False)\n    message_type = Column(String(20), default=\"text\")\n    metadata = Column(Text)  # JSON string\n    created_at = Column(DateTime, default=datetime.utcnow)\n\nclass KnowledgeBase(Base):\n    __tablename__ = \"knowledge_bases\"\n    \n    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)\n    name = Column(String(100), nullable=False)\n    description = Column(Text)\n    owner_id = Column(UUID(as_uuid=True), nullable=False)\n    status = Column(String(20), default=\"active\")\n    document_count = Column(Integer, default=0)\n    created_at = Column(DateTime, default=datetime.utcnow)\n    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n\nclass Document(Base):\n    __tablename__ = \"documents\"\n    \n    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)\n    knowledge_base_id = Column(UUID(as_uuid=True), nullable=False)\n    title = Column(String(200), nullable=False)\n    content = Column(Text)\n    doc_type = Column(String(20), nullable=False)\n    status = Column(String(20), default=\"uploaded\")\n    file_path = Column(String(500))\n    file_size = Column(Integer)\n    metadata = Column(Text)  # JSON string\n    created_at = Column(DateTime, default=datetime.utcnow)\n    processed_at = Column(DateTime)\n\n# æ•°æ®åº“ä¾èµ–\ndef get_db():\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n\n# åˆ›å»ºè¡¨\ndef create_tables():\n    Base.metadata.create_all(bind=engine)\n```\n\n### 3.5 å¯åŠ¨åç«¯æœåŠ¡\n```bash\n# åœ¨backendç›®å½•ä¸‹\nsource venv/bin/activate\n\n# åˆ›å»ºæ•°æ®åº“è¡¨\npython -c \"from app.models.database import create_tables; create_tables()\"\n\n# å¯åŠ¨å¼€å‘æœåŠ¡å™¨\nuvicorn app.main:app --reload --host 0.0.0.0 --port 8000\n```\n\n**éªŒè¯æ­¥éª¤**ï¼š\n1. æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8000\n2. è®¿é—® http://localhost:8000/docs æŸ¥çœ‹APIæ–‡æ¡£\n3. è®¿é—® http://localhost:8000/health æ£€æŸ¥å¥åº·çŠ¶æ€\n\n## 4. å‰ç«¯å®æ–½æ­¥éª¤\n\n### 4.1 åˆ›å»ºReacté¡¹ç›®\n```bash\ncd frontend\n\n# åˆ›å»ºReact TypeScripté¡¹ç›®\nnpx create-react-app . --template typescript\n\n# å®‰è£…é˜¿é‡ŒChatUIå’Œç›¸å…³ä¾èµ–\nnpm install @chatui/core\nnpm install react-markdown react-syntax-highlighter\nnpm install remark-math rehype-katex katex\nnpm install @types/react-syntax-highlighter\n\n# å®‰è£…ç®¡ç†ç•Œé¢ä¾èµ–\nnpm install antd @ant-design/icons\nnpm install react-router-dom @types/react-router-dom\nnpm install axios\nnpm install react-dropzone\n```\n\n### 4.2 åˆ›å»ºå‰ç«¯æ ¸å¿ƒæ–‡ä»¶\n\n#### 4.2.1 æ›´æ–°ä¸»Appç»„ä»¶\nåˆ›å»º `frontend/src/App.tsx`ï¼š\n```tsx\nimport React from 'react';\nimport { BrowserRouter as Router, Routes, Route } from 'react-router-dom';\nimport ChatPage from './pages/ChatPage';\nimport AdminLogin from './pages/admin/Login';\nimport AdminDashboard from './pages/admin/Dashboard';\nimport KnowledgeManagement from './pages/admin/KnowledgeManagement';\nimport './App.css';\n\nfunction App() {\n  return (\n    <Router>\n      <div className=\"App\">\n        <Routes>\n          {/* ç”¨æˆ·ç«¯è·¯ç”± */}\n          <Route path=\"/\" element={<ChatPage />} />\n          \n          {/* ç®¡ç†å‘˜ç«¯è·¯ç”± */}\n          <Route path=\"/admin\" element={<AdminLogin />} />\n          <Route path=\"/admin/dashboard\" element={<AdminDashboard />} />\n          <Route path=\"/admin/knowledge\" element={<KnowledgeManagement />} />\n        </Routes>\n      </div>\n    </Router>\n  );\n}\n\nexport default App;\n```\n\n#### 4.2.2 åˆ›å»ºèŠå¤©é¡µé¢\nåˆ›å»º `frontend/src/pages/ChatPage.tsx`ï¼š\n```tsx\nimport React, { useState, useEffect } from 'react';\nimport Chat, { Bubble, useMessages } from '@chatui/core';\nimport '@chatui/core/dist/index.css';\nimport { ChatService } from '../services/chatService';\nimport RichTextRenderer from '../components/RichTextRenderer';\n\nconst ChatPage: React.FC = () => {\n  const { messages, appendMsg, setTyping } = useMessages([]);\n  const [sessionId, setSessionId] = useState<string>('');\n\n  useEffect(() => {\n    initializeSession();\n  }, []);\n\n  const initializeSession = async () => {\n    try {\n      const session = await ChatService.initSession();\n      setSessionId(session.session_id);\n      \n      // æ·»åŠ æ¬¢è¿æ¶ˆæ¯\n      appendMsg({\n        type: 'text',\n        content: { text: 'æ‚¨å¥½ï¼æˆ‘æ˜¯æ™ºèƒ½å®¢æœåŠ©æ‰‹ ğŸ¤–\\n\\næˆ‘å¯ä»¥å¸®æ‚¨è§£ç­”å„ç§é—®é¢˜ï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨æƒ³äº†è§£ä»€ä¹ˆï¼Ÿ' },\n        user: { avatar: 'ğŸ¤–' },\n      });\n    } catch (error) {\n      console.error('Failed to initialize session:', error);\n    }\n  };\n\n  const handleSend = async (type: string, val: string) => {\n    if (type === 'text' && val.trim()) {\n      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n      appendMsg({\n        type: 'text',\n        content: { text: val },\n        position: 'right',\n      });\n\n      setTyping(true);\n\n      try {\n        const response = await ChatService.sendMessage(sessionId, val);\n        appendMsg({\n          type: 'text',\n          content: { text: response.content },\n          user: { avatar: 'ğŸ¤–' },\n        });\n      } catch (error) {\n        appendMsg({\n          type: 'text',\n          content: { text: 'æŠ±æ­‰ï¼ŒæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚' },\n          user: { avatar: 'ğŸ¤–' },\n        });\n      } finally {\n        setTyping(false);\n      }\n    }\n  };\n\n  const renderMessageContent = (msg: any) => {\n    const { content } = msg;\n    \n    if (msg.user?.avatar === 'ğŸ¤–') {\n      return (\n        <div className=\"ai-message\">\n          <RichTextRenderer content={content.text} />\n        </div>\n      );\n    }\n    \n    return <Bubble content={content.text} />;\n  };\n\n  return (\n    <div style={{ height: '100vh' }}>\n      <Chat\n        navbar={{ \n          title: 'æ™ºèƒ½å®¢æœ',\n          rightContent: (\n            <div style={{ fontSize: '12px', color: '#52c41a' }}>\n              â— åœ¨çº¿\n            </div>\n          )\n        }}\n        messages={messages}\n        renderMessageContent={renderMessageContent}\n        onSend={handleSend}\n        placeholder=\"è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...\"\n        quickReplies={[\n          { name: 'äº§å“åŠŸèƒ½', isNew: true, isHighlight: false },\n          { name: 'ä½¿ç”¨æ–¹æ³•', isNew: false, isHighlight: false },\n          { name: 'æŠ€æœ¯æ”¯æŒ', isNew: false, isHighlight: false },\n          { name: 'å¸¸è§é—®é¢˜', isNew: false, isHighlight: false },\n        ]}\n        onQuickReplyClick={(item) => handleSend('text', item.name)}\n      />\n    </div>\n  );\n};\n\nexport default ChatPage;\n```\n\n#### 4.2.3 åˆ›å»ºAPIæœåŠ¡\nåˆ›å»º `frontend/src/services/chatService.ts`ï¼š\n```typescript\nimport axios from 'axios';\n\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000/api/v1';\n\nconst apiClient = axios.create({\n  baseURL: API_BASE_URL,\n  timeout: 10000,\n});\n\nexport interface SessionResponse {\n  session_id: string;\n  expires_at: string;\n}\n\nexport interface MessageResponse {\n  content: string;\n  message_id: string;\n  timestamp: string;\n}\n\nexport class ChatService {\n  static async initSession(): Promise<SessionResponse> {\n    const response = await apiClient.post('/chat/sessions');\n    return response.data.data;\n  }\n\n  static async sendMessage(sessionId: string, message: string): Promise<MessageResponse> {\n    const response = await apiClient.post('/chat/messages', {\n      session_id: sessionId,\n      message: message,\n    });\n    return response.data.data;\n  }\n\n  static async getSessionHistory(sessionId: string) {\n    const response = await apiClient.get(`/chat/sessions/${sessionId}/messages`);\n    return response.data.data;\n  }\n}\n```\n\n### 4.3 å¯åŠ¨å‰ç«¯æœåŠ¡\n```bash\n# åœ¨frontendç›®å½•ä¸‹\nnpm start\n```\n\n**éªŒè¯æ­¥éª¤**ï¼š\n1. æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:3000\n2. æµ‹è¯•èŠå¤©åŠŸèƒ½æ˜¯å¦æ­£å¸¸\n3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯\n\n## 5. çŸ¥è¯†åº“åŠŸèƒ½å®æ–½\n\n### 5.1 å®‰è£…çŸ¥è¯†åº“ä¾èµ–\n```bash\n# åœ¨backendç›®å½•ä¸‹ï¼Œæ¿€æ´»è™šæ‹Ÿç¯å¢ƒ\nsource venv/bin/activate\n\n# å®‰è£…é¢å¤–çš„çŸ¥è¯†åº“ä¾èµ–\npip install rag-anything lightrag chromadb\npip install sentence-transformers transformers torch\n```\n\n### 5.2 åˆ›å»ºçŸ¥è¯†åº“æœåŠ¡\nåˆ›å»º `backend/app/services/knowledge_service.py`ï¼š\n```python\nfrom typing import List, Dict, Any, Optional\nimport uuid\nfrom datetime import datetime\nimport os\nimport aiofiles\nfrom ..models.database import Document, KnowledgeBase\nfrom ..core.config import settings\n\nclass KnowledgeService:\n    def __init__(self):\n        self.upload_dir = settings.UPLOAD_DIR\n        self.vector_dir = settings.VECTOR_DIR\n        \n        # ç¡®ä¿ç›®å½•å­˜åœ¨\n        os.makedirs(self.upload_dir, exist_ok=True)\n        os.makedirs(self.vector_dir, exist_ok=True)\n    \n    async def upload_document(self, file_content: bytes, filename: str, \n                            doc_type: str, knowledge_base_id: str,\n                            category: Optional[str] = None, \n                            tags: List[str] = None) -> str:\n        \"\"\"ä¸Šä¼ å¹¶å¤„ç†æ–‡æ¡£\"\"\"\n        # ç”Ÿæˆæ–‡æ¡£ID\n        doc_id = str(uuid.uuid4())\n        \n        # ä¿å­˜æ–‡ä»¶\n        file_path = os.path.join(self.upload_dir, f\"{doc_id}_{filename}\")\n        async with aiofiles.open(file_path, 'wb') as f:\n            await f.write(file_content)\n        \n        # åˆ›å»ºæ–‡æ¡£è®°å½•ï¼ˆè¿™é‡Œéœ€è¦æ•°æ®åº“æ“ä½œï¼‰\n        # å®é™…å®ç°ä¸­éœ€è¦ä½¿ç”¨SQLAlchemyè¿›è¡Œæ•°æ®åº“æ“ä½œ\n        \n        return doc_id\n    \n    async def process_document(self, doc_id: str):\n        \"\"\"å¤„ç†æ–‡æ¡£ï¼šè§£æ + å‘é‡åŒ–\"\"\"\n        # è¿™é‡Œå®ç°æ–‡æ¡£å¤„ç†é€»è¾‘\n        # 1. ä½¿ç”¨RAG-Anythingè§£ææ–‡æ¡£\n        # 2. ä½¿ç”¨LightRAGå‘é‡åŒ–\n        # 3. å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“\n        pass\n    \n    async def search_knowledge(self, query: str, knowledge_base_id: str, \n                             top_k: int = 5) -> List[Dict[str, Any]]:\n        \"\"\"æœç´¢çŸ¥è¯†åº“\"\"\"\n        # è¿™é‡Œå®ç°çŸ¥è¯†æ£€ç´¢é€»è¾‘\n        # 1. å‘é‡åŒ–æŸ¥è¯¢\n        # 2. ç›¸ä¼¼åº¦æœç´¢\n        # 3. è¿”å›ç»“æœ\n        return []\n```\n\n### 5.3 åˆ›å»ºçŸ¥è¯†åº“API\nåˆ›å»º `backend/app/api/v1/knowledge.py`ï¼š\n```python\nfrom fastapi import APIRouter, UploadFile, File, HTTPException, Depends\nfrom typing import List, Optional\nfrom sqlalchemy.orm import Session\nfrom ...models.database import get_db\nfrom ...services.knowledge_service import KnowledgeService\n\nrouter = APIRouter()\nknowledge_service = KnowledgeService()\n\n@router.post(\"/bases\")\nasync def create_knowledge_base(\n    name: str,\n    description: Optional[str] = None,\n    db: Session = Depends(get_db)\n):\n    \"\"\"åˆ›å»ºçŸ¥è¯†åº“\"\"\"\n    # å®ç°åˆ›å»ºçŸ¥è¯†åº“é€»è¾‘\n    return {\"message\": \"Knowledge base created successfully\"}\n\n@router.get(\"/bases\")\nasync def list_knowledge_bases(db: Session = Depends(get_db)):\n    \"\"\"è·å–çŸ¥è¯†åº“åˆ—è¡¨\"\"\"\n    # å®ç°è·å–çŸ¥è¯†åº“åˆ—è¡¨é€»è¾‘\n    return {\"data\": []}\n\n@router.post(\"/bases/{kb_id}/documents/upload\")\nasync def upload_document(\n    kb_id: str,\n    file: UploadFile = File(...),\n    doc_type: str = \"auto\",\n    category: Optional[str] = None,\n    tags: Optional[str] = None\n):\n    \"\"\"ä¸Šä¼ æ–‡æ¡£åˆ°çŸ¥è¯†åº“\"\"\"\n    try:\n        content = await file.read()\n        tag_list = tags.split(\",\") if tags else []\n        \n        doc_id = await knowledge_service.upload_document(\n            content, file.filename, doc_type, kb_id, category, tag_list\n        )\n        \n        return {\n            \"success\": True,\n            \"data\": {\"document_id\": doc_id},\n            \"message\": \"Document uploaded successfully\"\n        }\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=str(e))\n\n@router.post(\"/search\")\nasync def search_knowledge(\n    query: str,\n    knowledge_base_id: str,\n    top_k: int = 5\n):\n    \"\"\"æœç´¢çŸ¥è¯†åº“\"\"\"\n    try:\n        results = await knowledge_service.search_knowledge(\n            query, knowledge_base_id, top_k\n        )\n        return {\n            \"success\": True,\n            \"data\": {\"results\": results},\n            \"message\": \"Search completed\"\n        }\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=str(e))\n```\n\n## 6. Dockeréƒ¨ç½²å®æ–½\n\n### 6.1 åˆ›å»ºDockeré…ç½®æ–‡ä»¶\n\n#### 6.1.1 åç«¯Dockerfile\nåˆ›å»º `backend/Dockerfile`ï¼š\n```dockerfile\nFROM python:3.11-slim\n\nWORKDIR /app\n\n# å®‰è£…ç³»ç»Ÿä¾èµ–\nRUN apt-get update && apt-get install -y \\\n    build-essential \\\n    curl \\\n    && rm -rf /var/lib/apt/lists/*\n\n# å¤åˆ¶å¹¶å®‰è£…Pythonä¾èµ–\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\n# å¤åˆ¶åº”ç”¨ä»£ç \nCOPY app/ ./app/\n\n# åˆ›å»ºå¿…è¦ç›®å½•\nRUN mkdir -p data/uploads data/vectors data/logs\n\n# æš´éœ²ç«¯å£\nEXPOSE 8000\n\n# å¯åŠ¨å‘½ä»¤\nCMD [\"uvicorn\", \"app.main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\"]\n```\n\n#### 6.1.2 å‰ç«¯Dockerfile\nåˆ›å»º `frontend/Dockerfile`ï¼š\n```dockerfile\n# æ„å»ºé˜¶æ®µ\nFROM node:18-alpine as build\n\nWORKDIR /app\n\n# å¤åˆ¶packageæ–‡ä»¶\nCOPY package*.json ./\n\n# å®‰è£…ä¾èµ–\nRUN npm ci --only=production\n\n# å¤åˆ¶æºä»£ç \nCOPY . .\n\n# æ„å»ºåº”ç”¨\nRUN npm run build\n\n# ç”Ÿäº§é˜¶æ®µ\nFROM nginx:alpine\n\n# å¤åˆ¶æ„å»ºç»“æœ\nCOPY --from=build /app/build /usr/share/nginx/html\n\n# å¤åˆ¶nginxé…ç½®\nCOPY nginx.conf /etc/nginx/nginx.conf\n\n# æš´éœ²ç«¯å£\nEXPOSE 80\n\n# å¯åŠ¨nginx\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n#### 6.1.3 Docker Composeé…ç½®\nåˆ›å»º `docker-compose.yml`ï¼š\n```yaml\nversion: '3.8'\n\nservices:\n  # PostgreSQLæ•°æ®åº“\n  postgres:\n    image: postgres:15\n    environment:\n      POSTGRES_DB: ${POSTGRES_DB}\n      POSTGRES_USER: ${POSTGRES_USER}\n      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    ports:\n      - \"5432:5432\"\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U ${POSTGRES_USER}\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  # Redisç¼“å­˜\n  redis:\n    image: redis:7-alpine\n    ports:\n      - \"6379:6379\"\n    volumes:\n      - redis_data:/data\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"ping\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  # ChromaDBå‘é‡æ•°æ®åº“\n  chromadb:\n    image: chromadb/chroma:latest\n    ports:\n      - \"8001:8000\"\n    volumes:\n      - chroma_data:/chroma/chroma\n    environment:\n      - CHROMA_SERVER_HOST=0.0.0.0\n      - CHROMA_SERVER_HTTP_PORT=8000\n\n  # åç«¯æœåŠ¡\n  backend:\n    build: ./backend\n    ports:\n      - \"8000:8000\"\n    environment:\n      - DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB}\n      - REDIS_URL=redis://redis:6379\n      - CHROMA_URL=http://chromadb:8000\n    volumes:\n      - ./data:/app/data\n      - ./backend/app:/app/app\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n      chromadb:\n        condition: service_started\n    restart: unless-stopped\n\n  # å‰ç«¯æœåŠ¡\n  frontend:\n    build: ./frontend\n    ports:\n      - \"3000:80\"\n    environment:\n      - REACT_APP_API_URL=http://localhost:8000/api/v1\n    depends_on:\n      - backend\n    restart: unless-stopped\n\nvolumes:\n  postgres_data:\n  redis_data:\n  chroma_data:\n```\n\n### 6.2 éƒ¨ç½²å‘½ä»¤\n```bash\n# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡\ndocker compose up --build -d\n\n# æŸ¥çœ‹æœåŠ¡çŠ¶æ€\ndocker compose ps\n\n# æŸ¥çœ‹æ—¥å¿—\ndocker compose logs -f backend\ndocker compose logs -f frontend\n\n# åœæ­¢æœåŠ¡\ndocker compose down\n\n# å®Œå…¨æ¸…ç†ï¼ˆåŒ…æ‹¬æ•°æ®å·ï¼‰\ndocker compose down -v\n```\n\n## 7. æµ‹è¯•éªŒè¯æ­¥éª¤\n\n### 7.1 åç«¯APIæµ‹è¯•\n```bash\n# æµ‹è¯•å¥åº·æ£€æŸ¥\ncurl http://localhost:8000/health\n\n# æµ‹è¯•åˆ›å»ºä¼šè¯\ncurl -X POST \"http://localhost:8000/api/v1/chat/sessions\" \\\n     -H \"Content-Type: application/json\"\n\n# æµ‹è¯•å‘é€æ¶ˆæ¯\ncurl -X POST \"http://localhost:8000/api/v1/chat/messages\" \\\n     -H \"Content-Type: application/json\" \\\n     -d '{\"session_id\": \"your-session-id\", \"message\": \"ä½ å¥½\"}'\n\n# æµ‹è¯•çŸ¥è¯†åº“åˆ›å»º\ncurl -X POST \"http://localhost:8000/api/v1/knowledge/bases\" \\\n     -H \"Content-Type: application/json\" \\\n     -d '{\"name\": \"æµ‹è¯•çŸ¥è¯†åº“\", \"description\": \"è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•çŸ¥è¯†åº“\"}'\n```\n\n### 7.2 å‰ç«¯åŠŸèƒ½æµ‹è¯•\n1. **èŠå¤©åŠŸèƒ½æµ‹è¯•**ï¼š\n   - è®¿é—® http://localhost:3000\n   - æµ‹è¯•å‘é€æ¶ˆæ¯\n   - æµ‹è¯•å¿«é€Ÿå›å¤æŒ‰é’®\n   - æµ‹è¯•å¯Œæ–‡æœ¬æ¸²æŸ“\n\n2. **ç®¡ç†ç•Œé¢æµ‹è¯•**ï¼š\n   - è®¿é—® http://localhost:3000/admin\n   - æµ‹è¯•çŸ¥è¯†åº“ç®¡ç†\n   - æµ‹è¯•æ–‡æ¡£ä¸Šä¼ \n   - æµ‹è¯•ç³»ç»Ÿç›‘æ§\n\n### 7.3 é›†æˆæµ‹è¯•\n```bash\n# åˆ›å»ºæµ‹è¯•è„šæœ¬\ncat > test_integration.sh << 'EOF'\n#!/bin/bash\n\necho \"å¼€å§‹é›†æˆæµ‹è¯•...\"\n\n# æµ‹è¯•åç«¯å¥åº·çŠ¶æ€\necho \"æµ‹è¯•åç«¯å¥åº·çŠ¶æ€...\"\nresponse=$(curl -s http://localhost:8000/health)\nif [[ $response == *\"healthy\"* ]]; then\n    echo \"âœ… åç«¯æœåŠ¡æ­£å¸¸\"\nelse\n    echo \"âŒ åç«¯æœåŠ¡å¼‚å¸¸\"\n    exit 1\nfi\n\n# æµ‹è¯•å‰ç«¯è®¿é—®\necho \"æµ‹è¯•å‰ç«¯è®¿é—®...\"\nstatus_code=$(curl -s -o /dev/null -w \"%{http_code}\" http://localhost:3000)\nif [[ $status_code == \"200\" ]]; then\n    echo \"âœ… å‰ç«¯æœåŠ¡æ­£å¸¸\"\nelse\n    echo \"âŒ å‰ç«¯æœåŠ¡å¼‚å¸¸\"\n    exit 1\nfi\n\n# æµ‹è¯•æ•°æ®åº“è¿æ¥\necho \"æµ‹è¯•æ•°æ®åº“è¿æ¥...\"\n# è¿™é‡Œå¯ä»¥æ·»åŠ æ•°æ®åº“è¿æ¥æµ‹è¯•\n\necho \"âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼\"\nEOF\n\nchmod +x test_integration.sh\n./test_integration.sh\n```\n\n## 8. è¿ç»´å’Œç›‘æ§\n\n### 8.1 æ—¥å¿—ç®¡ç†\n```bash\n# æŸ¥çœ‹å®æ—¶æ—¥å¿—\ndocker compose logs -f backend\ndocker compose logs -f frontend\n\n# æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—\ndocker compose logs --since=\"2024-01-01T00:00:00\" backend\n\n# å¯¼å‡ºæ—¥å¿—åˆ°æ–‡ä»¶\ndocker compose logs backend > backend.log\n```\n\n### 8.2 æ€§èƒ½ç›‘æ§\n```bash\n# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ\ndocker stats\n\n# æŸ¥çœ‹ç³»ç»Ÿèµ„æº\ntop\nhtop\ndf -h\n```\n\n### 8.3 å¤‡ä»½å’Œæ¢å¤\n```bash\n# æ•°æ®åº“å¤‡ä»½\ndocker compose exec postgres pg_dump -U postgres ai_customer_service > backup.sql\n\n# æ•°æ®åº“æ¢å¤\ndocker compose exec -T postgres psql -U postgres ai_customer_service < backup.sql\n\n# æ–‡ä»¶æ•°æ®å¤‡ä»½\ntar -czf data_backup.tar.gz ./data/\n```\n\n## 9. æ•…éšœæ’é™¤\n\n### 9.1 å¸¸è§é—®é¢˜\n\n#### 9.1.1 åç«¯å¯åŠ¨å¤±è´¥\n```bash\n# æ£€æŸ¥ç«¯å£å ç”¨\nlsof -i :8000\n\n# æ£€æŸ¥Pythonä¾èµ–\npip list\n\n# æ£€æŸ¥ç¯å¢ƒå˜é‡\nenv | grep -E \"POSTGRES|REDIS|OPENAI\"\n```\n\n#### 9.1.2 å‰ç«¯æ„å»ºå¤±è´¥\n```bash\n# æ¸…ç†node_modules\nrm -rf node_modules package-lock.json\nnpm install\n\n# æ£€æŸ¥Node.jsç‰ˆæœ¬\nnode --version\nnpm --version\n```\n\n#### 9.1.3 æ•°æ®åº“è¿æ¥å¤±è´¥\n```bash\n# æ£€æŸ¥PostgreSQLçŠ¶æ€\ndocker compose ps postgres\n\n# æµ‹è¯•æ•°æ®åº“è¿æ¥\ndocker compose exec postgres psql -U postgres -d ai_customer_service -c \"SELECT 1;\"\n```\n\n### 9.2 æ€§èƒ½ä¼˜åŒ–\n\n#### 9.2.1 åç«¯ä¼˜åŒ–\n```python\n# åœ¨app/main.pyä¸­æ·»åŠ \nfrom fastapi.middleware.gzip import GZipMiddleware\n\napp.add_middleware(GZipMiddleware, minimum_size=1000)\n```\n\n#### 9.2.2 æ•°æ®åº“ä¼˜åŒ–\n```sql\n-- æ·»åŠ ç´¢å¼•\nCREATE INDEX idx_messages_session_id ON messages(session_id);\nCREATE INDEX idx_documents_knowledge_base_id ON documents(knowledge_base_id);\nCREATE INDEX idx_sessions_user_id ON sessions(user_id);\n```\n\n## 10. å¼€å‘è€…åä½œæŒ‡å—\n\n### 10.1 å¼€å‘ç¯å¢ƒé…ç½®\næ¯ä¸ªå¼€å‘è€…éœ€è¦æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\n\n```bash\n# 1. å…‹éš†é¡¹ç›®\ngit clone <repository-url>\ncd ai-customer-service\n\n# 2. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿\ncp .env.example .env\n# ç¼–è¾‘.envæ–‡ä»¶ï¼Œå¡«å…¥å®é™…é…ç½®\n\n# 3. å¯åŠ¨å¼€å‘ç¯å¢ƒ\ndocker compose -f docker-compose.dev.yml up -d\n\n# 4. å®‰è£…å‰ç«¯ä¾èµ–\ncd frontend\nnpm install\nnpm start\n\n# 5. å®‰è£…åç«¯ä¾èµ–\ncd ../backend\npython -m venv venv\nsource venv/bin/activate\npip install -r requirements.txt\nuvicorn app.main:app --reload\n```\n\n### 10.2 ä»£ç æäº¤è§„èŒƒ\n```bash\n# æäº¤æ ¼å¼\ngit commit -m \"<type>(<scope>): <description>\"\n\n# ç¤ºä¾‹\ngit commit -m \"feat(chat): æ·»åŠ è¯­éŸ³è¾“å…¥åŠŸèƒ½\"\ngit commit -m \"fix(knowledge): ä¿®å¤æ–‡æ¡£ä¸Šä¼ bug\"\ngit commit -m \"docs(readme): æ›´æ–°éƒ¨ç½²æ–‡æ¡£\"\n```\n\n### 10.3 åˆ†æ”¯ç®¡ç†\n- `main`: ä¸»åˆ†æ”¯ï¼Œç”¨äºç”Ÿäº§ç¯å¢ƒ\n- `develop`: å¼€å‘åˆ†æ”¯ï¼Œç”¨äºé›†æˆæµ‹è¯•\n- `feature/*`: åŠŸèƒ½åˆ†æ”¯ï¼Œç”¨äºå¼€å‘æ–°åŠŸèƒ½\n- `hotfix/*`: çƒ­ä¿®å¤åˆ†æ”¯ï¼Œç”¨äºç´§æ€¥ä¿®å¤\n\né€šè¿‡ä»¥ä¸Šå®æ–½æ‰‹å†Œï¼Œè¿ç»´å·¥ç¨‹å¸ˆå¯ä»¥æŒ‰æ­¥éª¤å®Œæˆæ•´ä¸ªæ™ºèƒ½å®¢æœç³»ç»Ÿçš„éƒ¨ç½²å’Œé…ç½®ï¼Œç¡®ä¿ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚