# å‰ç«¯èŠå¤©ç•Œé¢å®æ–½

## ğŸ¯ ç›®æ ‡
ä½¿ç”¨é˜¿é‡ŒChatUIå®ç°ä¸“ä¸šçš„èŠå¤©ç•Œé¢ï¼Œæ”¯æŒæ¶ˆæ¯æ”¶å‘ã€å¯Œæ–‡æœ¬æ¸²æŸ“å’Œç”¨æˆ·äº¤äº’ã€‚

## ğŸ“‹ å‰ç½®æ¡ä»¶
- Node.js 18+ å·²å®‰è£…
- é¡¹ç›®ç›®å½•ç»“æ„å·²åˆ›å»º

## ğŸ”§ å®æ–½æ­¥éª¤

### 1. åˆ›å»ºReacté¡¹ç›®
```bash
cd frontend
npx create-react-app . --template typescript
```

### 2. å®‰è£…ChatUIä¾èµ–
```bash
# å®‰è£…é˜¿é‡ŒChatUI
npm install @chatui/core

# å®‰è£…å¯Œæ–‡æœ¬æ¸²æŸ“ä¾èµ–
npm install react-markdown react-syntax-highlighter
npm install remark-math rehype-katex katex

# å®‰è£…ç±»å‹å®šä¹‰
npm install --save-dev @types/react-syntax-highlighter

# å®‰è£…HTTPå®¢æˆ·ç«¯
npm install axios
```

### 3. åˆ›å»ºèŠå¤©æœåŠ¡
åˆ›å»º `src/services/chatService.ts`ï¼š
```typescript
import axios from 'axios';

const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000/api/v1';

const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000,
});

export interface SessionResponse {
  session_id: string;
  expires_at: string;
}

export interface MessageResponse {
  content: string;
  message_id: string;
  timestamp: string;
}

export class ChatService {
  static async initSession(): Promise<SessionResponse> {
    const response = await apiClient.post('/chat/sessions');
    return response.data.data;
  }

  static async sendMessage(sessionId: string, message: string): Promise<MessageResponse> {
    const response = await apiClient.post('/chat/messages', {
      session_id: sessionId,
      message: message,
    });
    return response.data.data;
  }

  static async getSessionHistory(sessionId: string) {
    const response = await apiClient.get(`/chat/sessions/${sessionId}/messages`);
    return response.data.data;
  }
}
```

### 4. åˆ›å»ºå¯Œæ–‡æœ¬æ¸²æŸ“ç»„ä»¶
åˆ›å»º `src/components/RichTextRenderer.tsx`ï¼š
```tsx
import React from 'react';
import ReactMarkdown from 'react-markdown';
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';
import { tomorrow } from 'react-syntax-highlighter/dist/esm/styles/prism';
import remarkMath from 'remark-math';
import rehypeKatex from 'rehype-katex';
import 'katex/dist/katex.min.css';

interface RichTextRendererProps {
  content: string;
}

const RichTextRenderer: React.FC<RichTextRendererProps> = ({ content }) => {
  const components = {
    code({ node, inline, className, children, ...props }: any) {
      const match = /language-(\w+)/.exec(className || '');
      return !inline && match ? (
        <SyntaxHighlighter
          style={tomorrow}
          language={match[1]}
          PreTag="div"
          {...props}
        >
          {String(children).replace(/\n$/, '')}
        </SyntaxHighlighter>
      ) : (
        <code className={className} {...props}>
          {children}
        </code>
      );
    },
    
    table: ({ children }: any) => (
      <div className="table-container">
        <table className="rich-table">{children}</table>
      </div>
    ),
    
    a: ({ href, children }: any) => (
      <a 
        href={href} 
        target="_blank" 
        rel="noopener noreferrer"
        className="rich-link"
      >
        {children}
      </a>
    )
  };

  return (
    <div className="rich-content">
      <ReactMarkdown
        components={components}
        remarkPlugins={[remarkMath]}
        rehypePlugins={[rehypeKatex]}
      >
        {content}
      </ReactMarkdown>
    </div>
  );
};

export default RichTextRenderer;
```

### 5. åˆ›å»ºä¸»èŠå¤©ç»„ä»¶
åˆ›å»º `src/App.tsx`ï¼š
```tsx
import React, { useState, useEffect } from 'react';
import Chat, { Bubble, useMessages } from '@chatui/core';
import '@chatui/core/dist/index.css';
import { ChatService } from './services/chatService';
import RichTextRenderer from './components/RichTextRenderer';
import './App.css';

const App: React.FC = () => {
  const { messages, appendMsg, setTyping } = useMessages([]);
  const [sessionId, setSessionId] = useState<string>('');

  useEffect(() => {
    initializeSession();
  }, []);

  const initializeSession = async () => {
    try {
      const session = await ChatService.initSession();
      setSessionId(session.session_id);
      
      // æ·»åŠ æ¬¢è¿æ¶ˆæ¯
      appendMsg({
        type: 'text',
        content: { text: 'æ‚¨å¥½ï¼æˆ‘æ˜¯æ™ºèƒ½å®¢æœåŠ©æ‰‹ ğŸ¤–\n\næˆ‘å¯ä»¥å¸®æ‚¨è§£ç­”å„ç§é—®é¢˜ï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨æƒ³äº†è§£ä»€ä¹ˆï¼Ÿ' },
        user: { avatar: 'ğŸ¤–' },
      });
    } catch (error) {
      console.error('Failed to initialize session:', error);
    }
  };

  const handleSend = async (type: string, val: string) => {
    if (type === 'text' && val.trim()) {
      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
      appendMsg({
        type: 'text',
        content: { text: val },
        position: 'right',
      });

      setTyping(true);

      try {
        const response = await ChatService.sendMessage(sessionId, val);
        appendMsg({
          type: 'text',
          content: { text: response.content },
          user: { avatar: 'ğŸ¤–' },
        });
      } catch (error) {
        appendMsg({
          type: 'text',
          content: { text: 'æŠ±æ­‰ï¼ŒæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚' },
          user: { avatar: 'ğŸ¤–' },
        });
      } finally {
        setTyping(false);
      }
    }
  };

  const renderMessageContent = (msg: any) => {
    const { content } = msg;
    
    if (msg.user?.avatar === 'ğŸ¤–') {
      return (
        <div className="ai-message">
          <RichTextRenderer content={content.text} />
        </div>
      );
    }
    
    return <Bubble content={content.text} />;
  };

  return (
    <div style={{ height: '100vh' }}>
      <Chat
        navbar={{ 
          title: 'æ™ºèƒ½å®¢æœ',
          rightContent: (
            <div style={{ fontSize: '12px', color: '#52c41a' }}>
              â— åœ¨çº¿
            </div>
          )
        }}
        messages={messages}
        renderMessageContent={renderMessageContent}
        onSend={handleSend}
        placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."
        quickReplies={[
          { name: 'äº§å“åŠŸèƒ½', isNew: true, isHighlight: false },
          { name: 'ä½¿ç”¨æ–¹æ³•', isNew: false, isHighlight: false },
          { name: 'æŠ€æœ¯æ”¯æŒ', isNew: false, isHighlight: false },
          { name: 'å¸¸è§é—®é¢˜', isNew: false, isHighlight: false },
        ]}
        onQuickReplyClick={(item) => handleSend('text', item.name)}
      />
    </div>
  );
};

export default App;
```

### 6. æ·»åŠ æ ·å¼æ–‡ä»¶
åˆ›å»º `src/App.css`ï¼š
```css
.ai-message {
  max-width: 100%;
}

.rich-content {
  line-height: 1.6;
  color: #333;
}

.rich-content h1, .rich-content h2, .rich-content h3 {
  margin: 16px 0 8px 0;
  font-weight: 600;
}

.rich-content h1 { font-size: 20px; }
.rich-content h2 { font-size: 18px; }
.rich-content h3 { font-size: 16px; }

.rich-content p {
  margin: 8px 0;
}

.rich-content ul, .rich-content ol {
  margin: 8px 0;
  padding-left: 20px;
}

.rich-content code {
  background: #f1f3f4;
  padding: 2px 4px;
  border-radius: 3px;
  font-family: 'Monaco', 'Consolas', monospace;
  font-size: 0.9em;
}

.rich-table {
  width: 100%;
  border-collapse: collapse;
  margin: 12px 0;
  font-size: 14px;
}

.rich-table th,
.rich-table td {
  border: 1px solid #e0e0e0;
  padding: 6px 10px;
  text-align: left;
}

.rich-table th {
  background: #f8f9fa;
  font-weight: 600;
}

.rich-link {
  color: #007bff;
  text-decoration: none;
}

.rich-link:hover {
  text-decoration: underline;
}

.table-container {
  overflow-x: auto;
}
```

### 7. é…ç½®ç¯å¢ƒå˜é‡
åˆ›å»º `frontend/.env`ï¼š
```
REACT_APP_API_URL=http://localhost:8000/api/v1
```

## âœ… éªŒè¯æ­¥éª¤

### 1. å¯åŠ¨å‰ç«¯æœåŠ¡
```bash
cd frontend
npm start
```

### 2. æ£€æŸ¥ç•Œé¢
- [ ] æµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€ http://localhost:3000
- [ ] ChatUIç•Œé¢æ­£å¸¸æ˜¾ç¤º
- [ ] å¯¼èˆªæ æ˜¾ç¤º"æ™ºèƒ½å®¢æœ"å’Œåœ¨çº¿çŠ¶æ€
- [ ] è¾“å…¥æ¡†å’Œå¿«é€Ÿå›å¤æŒ‰é’®å¯è§

### 3. æµ‹è¯•åŸºç¡€åŠŸèƒ½
- [ ] è¾“å…¥æ¡†å¯ä»¥è¾“å…¥æ–‡å­—
- [ ] å¿«é€Ÿå›å¤æŒ‰é’®å¯ä»¥ç‚¹å‡»
- [ ] æ¶ˆæ¯æ°”æ³¡æ ·å¼æ­£ç¡®
- [ ] æ¬¢è¿æ¶ˆæ¯æ­£å¸¸æ˜¾ç¤º

### 4. æ£€æŸ¥æ§åˆ¶å°
- [ ] æ— JavaScripté”™è¯¯
- [ ] ç½‘ç»œè¯·æ±‚æ­£å¸¸ï¼ˆå¯èƒ½ä¼šæœ‰APIè¿æ¥é”™è¯¯ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼‰

## ğŸš¨ å¸¸è§é—®é¢˜

### ä¾èµ–å®‰è£…å¤±è´¥
```bash
# æ¸…ç†ç¼“å­˜é‡æ–°å®‰è£…
rm -rf node_modules package-lock.json
npm install
```

### ChatUIæ ·å¼é—®é¢˜
```bash
# ç¡®ä¿CSSæ–‡ä»¶æ­£ç¡®å¯¼å…¥
import '@chatui/core/dist/index.css';
```

### TypeScripté”™è¯¯
```bash
# æ£€æŸ¥ç±»å‹å®šä¹‰æ˜¯å¦æ­£ç¡®å®‰è£…
npm install --save-dev @types/react @types/react-dom
```

## â¡ï¸ ä¸‹ä¸€æ­¥
å‰ç«¯ç•Œé¢å®Œæˆåï¼Œç»§ç»­ [åç«¯èŠå¤©API](./åç«¯èŠå¤©API.md)