# çŸ¥è¯†åº“ç®¡ç†åŠŸèƒ½æµ‹è¯•

## ğŸ¯ ç›®æ ‡
éªŒè¯çŸ¥è¯†åº“ç®¡ç†çš„æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æŒ‰ç…§äº§å“æ–‡æ¡£çš„è¦æ±‚æ­£å¸¸å·¥ä½œã€‚

## ğŸ“‹ æµ‹è¯•èŒƒå›´
åŸºäºäº§å“æ–‡æ¡£çš„ç®¡ç†ç«¯åŠŸèƒ½è¦æ±‚ï¼Œæµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š
- çŸ¥è¯†åº“CRUDæ“ä½œ
- æ–‡æ¡£ä¸Šä¼ å’Œè§£æ
- å‘é‡åŒ–å¤„ç†
- æ™ºèƒ½æ£€ç´¢
- ç®¡ç†ç•Œé¢äº¤äº’

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### 1. çŸ¥è¯†åº“ç®¡ç†æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹1.1ï¼šåˆ›å»ºçŸ¥è¯†åº“
**æµ‹è¯•æ­¥éª¤**ï¼š
1. è®¿é—® http://localhost:3000/admin/knowledge
2. ç‚¹å‡»"åˆ›å»ºçŸ¥è¯†åº“"æŒ‰é’®
3. è¾“å…¥çŸ¥è¯†åº“åç§°ï¼š"æµ‹è¯•çŸ¥è¯†åº“"
4. è¾“å…¥æè¿°ï¼š"è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨çš„çŸ¥è¯†åº“"
5. ç‚¹å‡»ç¡®å®š

**é¢„æœŸç»“æœ**ï¼š
- [ ] æ¨¡æ€æ¡†æ­£å¸¸æ‰“å¼€
- [ ] è¡¨å•éªŒè¯æ­£å¸¸å·¥ä½œ
- [ ] åˆ›å»ºæˆåŠŸåæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
- [ ] çŸ¥è¯†åº“åˆ—è¡¨è‡ªåŠ¨åˆ·æ–°
- [ ] æ–°çŸ¥è¯†åº“å‡ºç°åœ¨åˆ—è¡¨ä¸­

#### æµ‹è¯•ç”¨ä¾‹1.2ï¼šç¼–è¾‘çŸ¥è¯†åº“
**æµ‹è¯•æ­¥éª¤**ï¼š
1. åœ¨çŸ¥è¯†åº“åˆ—è¡¨ä¸­ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®
2. ä¿®æ”¹çŸ¥è¯†åº“åç§°ä¸ºï¼š"æ›´æ–°åçš„çŸ¥è¯†åº“"
3. ä¿®æ”¹çŠ¶æ€ä¸º"æœªæ¿€æ´»"
4. ç‚¹å‡»ç¡®å®š

**é¢„æœŸç»“æœ**ï¼š
- [ ] ç¼–è¾‘æ¨¡æ€æ¡†æ­£å¸¸æ‰“å¼€å¹¶é¢„å¡«æ•°æ®
- [ ] æ›´æ–°æˆåŠŸåæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
- [ ] åˆ—è¡¨ä¸­çš„æ•°æ®å·²æ›´æ–°
- [ ] çŠ¶æ€æ ‡ç­¾é¢œè‰²æ­£ç¡®æ˜¾ç¤º

#### æµ‹è¯•ç”¨ä¾‹1.3ï¼šåˆ é™¤çŸ¥è¯†åº“
**æµ‹è¯•æ­¥éª¤**ï¼š
1. ç‚¹å‡»çŸ¥è¯†åº“çš„"åˆ é™¤"æŒ‰é’®
2. åœ¨ç¡®è®¤å¯¹è¯æ¡†ä¸­ç‚¹å‡»ç¡®å®š

**é¢„æœŸç»“æœ**ï¼š
- [ ] ç¡®è®¤å¯¹è¯æ¡†æ­£å¸¸æ˜¾ç¤º
- [ ] åˆ é™¤æˆåŠŸåæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
- [ ] çŸ¥è¯†åº“ä»åˆ—è¡¨ä¸­æ¶ˆå¤±æˆ–çŠ¶æ€å˜ä¸º"å·²åˆ é™¤"

### 2. åç«¯APIæµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹2.1ï¼šAPIæ¥å£æµ‹è¯•
åˆ›å»ºæµ‹è¯•è„šæœ¬ `test_knowledge_api.py`ï¼š
```python
import requests
import json

BASE_URL = "http://localhost:8000/api/v1/knowledge"

def test_knowledge_base_crud():
    """æµ‹è¯•çŸ¥è¯†åº“CRUDæ“ä½œ"""
    
    # 1. åˆ›å»ºçŸ¥è¯†åº“
    create_data = {
        "name": "APIæµ‹è¯•çŸ¥è¯†åº“",
        "description": "é€šè¿‡APIåˆ›å»ºçš„æµ‹è¯•çŸ¥è¯†åº“"
    }
    
    response = requests.post(f"{BASE_URL}/bases", json=create_data)
    assert response.status_code == 201, f"åˆ›å»ºå¤±è´¥: {response.text}"
    
    kb_data = response.json()
    kb_id = kb_data["id"]
    print(f"âœ… çŸ¥è¯†åº“åˆ›å»ºæˆåŠŸ: {kb_id}")
    
    # 2. è·å–çŸ¥è¯†åº“åˆ—è¡¨
    response = requests.get(f"{BASE_URL}/bases")
    assert response.status_code == 200, f"è·å–åˆ—è¡¨å¤±è´¥: {response.text}"
    
    kbs = response.json()
    assert len(kbs) > 0, "çŸ¥è¯†åº“åˆ—è¡¨ä¸ºç©º"
    print(f"âœ… çŸ¥è¯†åº“åˆ—è¡¨è·å–æˆåŠŸ: {len(kbs)}ä¸ª")
    
    # 3. è·å–çŸ¥è¯†åº“è¯¦æƒ…
    response = requests.get(f"{BASE_URL}/bases/{kb_id}")
    assert response.status_code == 200, f"è·å–è¯¦æƒ…å¤±è´¥: {response.text}"
    
    kb_detail = response.json()
    assert kb_detail["name"] == create_data["name"], "çŸ¥è¯†åº“åç§°ä¸åŒ¹é…"
    print("âœ… çŸ¥è¯†åº“è¯¦æƒ…è·å–æˆåŠŸ")
    
    # 4. æ›´æ–°çŸ¥è¯†åº“
    update_data = {
        "name": "æ›´æ–°åçš„çŸ¥è¯†åº“",
        "description": "æ›´æ–°åçš„æè¿°"
    }
    
    response = requests.put(f"{BASE_URL}/bases/{kb_id}", json=update_data)
    assert response.status_code == 200, f"æ›´æ–°å¤±è´¥: {response.text}"
    
    updated_kb = response.json()
    assert updated_kb["name"] == update_data["name"], "æ›´æ–°ååç§°ä¸åŒ¹é…"
    print("âœ… çŸ¥è¯†åº“æ›´æ–°æˆåŠŸ")
    
    # 5. åˆ é™¤çŸ¥è¯†åº“
    response = requests.delete(f"{BASE_URL}/bases/{kb_id}")
    assert response.status_code == 200, f"åˆ é™¤å¤±è´¥: {response.text}"
    print("âœ… çŸ¥è¯†åº“åˆ é™¤æˆåŠŸ")
    
    # 6. éªŒè¯åˆ é™¤
    response = requests.get(f"{BASE_URL}/bases/{kb_id}")
    assert response.status_code == 404, "åˆ é™¤åä»èƒ½è®¿é—®"
    print("âœ… åˆ é™¤éªŒè¯æˆåŠŸ")

if __name__ == "__main__":
    test_knowledge_base_crud()
    print("ğŸ‰ æ‰€æœ‰APIæµ‹è¯•é€šè¿‡")
```

è¿è¡Œæµ‹è¯•ï¼š
```bash
cd backend
python test_knowledge_api.py
```

### 3. æ–‡æ¡£å¤„ç†æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹3.1ï¼šæ–‡æ¡£ä¸Šä¼ æµ‹è¯•
**æµ‹è¯•æ­¥éª¤**ï¼š
1. å‡†å¤‡æµ‹è¯•æ–‡ä»¶ï¼š
   ```bash
   # åˆ›å»ºæµ‹è¯•æ–‡ä»¶
   echo "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡æ¡£ã€‚åŒ…å«äº§å“åŠŸèƒ½ä»‹ç»ã€‚" > test.txt
   echo "# äº§å“æ–‡æ¡£\n\n## åŠŸèƒ½åˆ—è¡¨\n- æ™ºèƒ½é—®ç­”\n- çŸ¥è¯†ç®¡ç†" > test.md
   ```

2. åœ¨ç®¡ç†ç•Œé¢ä¸Šä¼ æ–‡ä»¶
3. æ£€æŸ¥æ–‡æ¡£å¤„ç†çŠ¶æ€

**é¢„æœŸç»“æœ**ï¼š
- [ ] æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
- [ ] æ–‡æ¡£çŠ¶æ€ä»"uploaded"å˜ä¸º"processing"å†åˆ°"processed"
- [ ] æ–‡æ¡£å†…å®¹æ­£ç¡®è§£æ
- [ ] å‘é‡åŒ–å¤„ç†å®Œæˆ

#### æµ‹è¯•ç”¨ä¾‹3.2ï¼šæ–‡æ¡£æœç´¢æµ‹è¯•
åˆ›å»ºæœç´¢æµ‹è¯•è„šæœ¬ï¼š
```python
import requests

def test_document_search():
    """æµ‹è¯•æ–‡æ¡£æœç´¢åŠŸèƒ½"""
    
    search_data = {
        "query": "äº§å“åŠŸèƒ½",
        "top_k": 5
    }
    
    response = requests.post(
        "http://localhost:8000/api/v1/knowledge/search",
        json=search_data
    )
    
    assert response.status_code == 200, f"æœç´¢å¤±è´¥: {response.text}"
    
    results = response.json()
    assert "results" in results, "æœç´¢ç»“æœæ ¼å¼é”™è¯¯"
    
    search_results = results["results"]
    print(f"âœ… æœç´¢åˆ° {len(search_results)} ä¸ªç»“æœ")
    
    for i, result in enumerate(search_results):
        print(f"ç»“æœ {i+1}:")
        print(f"  ç›¸å…³åº¦: {result.get('score', 0):.2f}")
        print(f"  å†…å®¹: {result.get('content', '')[:100]}...")

if __name__ == "__main__":
    test_document_search()
```

### 4. é›†æˆæµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹4.1ï¼šå®Œæ•´æµç¨‹æµ‹è¯•
**æµ‹è¯•æ­¥éª¤**ï¼š
1. åˆ›å»ºçŸ¥è¯†åº“
2. ä¸Šä¼ å¤šä¸ªä¸åŒæ ¼å¼çš„æ–‡æ¡£
3. ç­‰å¾…æ–‡æ¡£å¤„ç†å®Œæˆ
4. åœ¨èŠå¤©ç•Œé¢æµ‹è¯•çŸ¥è¯†æ£€ç´¢
5. éªŒè¯AIå›å¤çš„å‡†ç¡®æ€§

**è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬**ï¼š
```bash
#!/bin/bash
echo "=== çŸ¥è¯†åº“ç®¡ç†é›†æˆæµ‹è¯• ==="

# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo "æ£€æŸ¥åç«¯æœåŠ¡..."
if curl -s http://localhost:8000/health | grep -q "healthy"; then
    echo "âœ… åç«¯æœåŠ¡æ­£å¸¸"
else
    echo "âŒ åç«¯æœåŠ¡å¼‚å¸¸"
    exit 1
fi

echo "æ£€æŸ¥å‰ç«¯æœåŠ¡..."
if curl -s http://localhost:3000 | grep -q "html"; then
    echo "âœ… å‰ç«¯æœåŠ¡æ­£å¸¸"
else
    echo "âŒ å‰ç«¯æœåŠ¡å¼‚å¸¸"
    exit 1
fi

# 2. æµ‹è¯•APIæ¥å£
echo "æµ‹è¯•çŸ¥è¯†åº“API..."
python test_knowledge_api.py

# 3. æµ‹è¯•æ–‡æ¡£æœç´¢
echo "æµ‹è¯•æ–‡æ¡£æœç´¢..."
python test_document_search.py

echo "ğŸ‰ é›†æˆæµ‹è¯•å®Œæˆ"
```

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### å¹¶å‘æµ‹è¯•
```python
import asyncio
import aiohttp
import time

async def concurrent_requests():
    """å¹¶å‘è¯·æ±‚æµ‹è¯•"""
    async with aiohttp.ClientSession() as session:
        tasks = []
        start_time = time.time()
        
        # åˆ›å»º100ä¸ªå¹¶å‘è¯·æ±‚
        for i in range(100):
            task = session.get("http://localhost:8000/api/v1/knowledge/bases")
            tasks.append(task)
        
        responses = await asyncio.gather(*tasks)
        end_time = time.time()
        
        success_count = sum(1 for r in responses if r.status == 200)
        print(f"å¹¶å‘æµ‹è¯•ç»“æœ: {success_count}/100 æˆåŠŸ")
        print(f"æ€»è€—æ—¶: {end_time - start_time:.2f}ç§’")

asyncio.run(concurrent_requests())
```

## ğŸš¨ æ•…éšœæ’é™¤

### æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥PostgreSQLçŠ¶æ€
docker compose ps postgres

# æµ‹è¯•æ•°æ®åº“è¿æ¥
python -c "from app.models.database import engine; print(engine.execute('SELECT 1').scalar())"
```

### å‘é‡æœåŠ¡é—®é¢˜
```bash
# æ£€æŸ¥ChromaDBçŠ¶æ€
curl http://localhost:8001/api/v1/heartbeat

# æµ‹è¯•å‘é‡æœåŠ¡
python -c "import chromadb; client = chromadb.Client(); print('ChromaDBè¿æ¥æˆåŠŸ')"
```

### æ–‡ä»¶ä¸Šä¼ é—®é¢˜
```bash
# æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™
ls -la data/uploads/
chmod 755 data/uploads/
```

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
# çŸ¥è¯†åº“ç®¡ç†åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š

## æµ‹è¯•ç¯å¢ƒ
- æ“ä½œç³»ç»Ÿ: 
- Pythonç‰ˆæœ¬: 
- Node.jsç‰ˆæœ¬: 
- æ•°æ®åº“ç‰ˆæœ¬: 

## æµ‹è¯•ç»“æœ
- [ ] çŸ¥è¯†åº“CRUD: é€šè¿‡/å¤±è´¥
- [ ] æ–‡æ¡£ä¸Šä¼ : é€šè¿‡/å¤±è´¥  
- [ ] æ–‡æ¡£è§£æ: é€šè¿‡/å¤±è´¥
- [ ] å‘é‡åŒ–å¤„ç†: é€šè¿‡/å¤±è´¥
- [ ] æ™ºèƒ½æ£€ç´¢: é€šè¿‡/å¤±è´¥
- [ ] ç®¡ç†ç•Œé¢: é€šè¿‡/å¤±è´¥

## æ€§èƒ½æŒ‡æ ‡
- APIå“åº”æ—¶é—´: 
- æ–‡æ¡£å¤„ç†é€Ÿåº¦: 
- å¹¶å‘å¤„ç†èƒ½åŠ›: 

## é—®é¢˜è®°å½•
1. é—®é¢˜æè¿°
   - è§£å†³æ–¹æ¡ˆ
   - çŠ¶æ€: å·²è§£å†³/å¾…è§£å†³
```

## âœ… éªŒæ”¶æ ‡å‡†

æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡åï¼ŒçŸ¥è¯†åº“ç®¡ç†åŠŸèƒ½åº”è¯¥æ»¡è¶³ï¼š
- [ ] åŠŸèƒ½å®Œæ•´æ€§ï¼šæ‰€æœ‰CRUDæ“ä½œæ­£å¸¸
- [ ] æ•°æ®ä¸€è‡´æ€§ï¼šæ•°æ®åº“å’Œç•Œé¢æ•°æ®åŒæ­¥
- [ ] æ€§èƒ½è¦æ±‚ï¼šAPIå“åº”æ—¶é—´ < 2ç§’
- [ ] é”™è¯¯å¤„ç†ï¼šå¼‚å¸¸æƒ…å†µæœ‰å‹å¥½æç¤º
- [ ] ç”¨æˆ·ä½“éªŒï¼šç•Œé¢æ“ä½œæµç•…ç›´è§‚

## ğŸ‰ æµ‹è¯•å®Œæˆ
æ‰€æœ‰æµ‹è¯•é€šè¿‡åï¼ŒçŸ¥è¯†åº“ç®¡ç†åŠŸèƒ½å®æ–½å®Œæˆï¼Œå¯ä»¥è¿›å…¥ä¸‹ä¸€ä¸ªæ¨¡å—çš„å¼€å‘ã€‚