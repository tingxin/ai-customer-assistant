# çŸ¥è¯†åº“ç®¡ç†ç•Œé¢å®ç°

## ğŸ¯ ç›®æ ‡
åŸºäºå¼€å‘æ–‡æ¡£çš„ç®¡ç†ç«¯æ¨¡å—è®¾è®¡ï¼Œä½¿ç”¨Ant Designå®ç°çŸ¥è¯†åº“ç®¡ç†çš„å‰ç«¯ç•Œé¢ã€‚

## ğŸ“‹ å‰ç½®æ¡ä»¶
- çŸ¥è¯†åº“APIå·²å®ç°å¹¶æ­£å¸¸è¿è¡Œ
- Reacté¡¹ç›®å·²åˆ›å»º

## ğŸ¨ ç®¡ç†ç•Œé¢å®ç°

### 1. å®‰è£…Ant Designä¾èµ–

```bash
cd frontend
npm install antd @ant-design/icons
npm install react-router-dom @types/react-router-dom
npm install react-dropzone
```

### 2. åˆ›å»ºçŸ¥è¯†åº“æœåŠ¡

åˆ›å»º `frontend/src/services/knowledgeService.ts`ï¼š
```typescript
import axios from 'axios';

const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000/api/v1';

const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 30000,
});

export interface KnowledgeBase {
  id: string;
  name: string;
  description?: string;
  owner_id: string;
  status: 'active' | 'inactive' | 'deleted';
  document_count: number;
  created_at: string;
  updated_at: string;
}

export interface CreateKnowledgeBaseRequest {
  name: string;
  description?: string;
}

export interface UpdateKnowledgeBaseRequest {
  name?: string;
  description?: string;
  status?: 'active' | 'inactive';
}

export class KnowledgeBaseService {
  static async getKnowledgeBases(): Promise<KnowledgeBase[]> {
    const response = await apiClient.get('/knowledge/bases');
    return response.data;
  }

  static async createKnowledgeBase(data: CreateKnowledgeBaseRequest): Promise<KnowledgeBase> {
    const response = await apiClient.post('/knowledge/bases', data);
    return response.data;
  }

  static async updateKnowledgeBase(id: string, data: UpdateKnowledgeBaseRequest): Promise<KnowledgeBase> {
    const response = await apiClient.put(`/knowledge/bases/${id}`, data);
    return response.data;
  }

  static async deleteKnowledgeBase(id: string, hardDelete: boolean = false): Promise<void> {
    await apiClient.delete(`/knowledge/bases/${id}?hard_delete=${hardDelete}`);
  }

  static async uploadDocument(kbId: string, file: File, docType: string): Promise<any> {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('doc_type', docType);

    const response = await apiClient.post(`/knowledge/bases/${kbId}/documents/upload`, formData, {
      headers: {
        'Content-Type': 'multipart/form-data',
      },
    });
    return response.data;
  }
}
```

### 3. åˆ›å»ºçŸ¥è¯†åº“åˆ—è¡¨é¡µé¢

åˆ›å»º `frontend/src/pages/admin/KnowledgeBaseList.tsx`ï¼š
```tsx
import React, { useState, useEffect } from 'react';
import {
  Layout,
  Card,
  Button,
  Table,
  Modal,
  Form,
  Input,
  Select,
  message,
  Tag,
  Space,
  Popconfirm,
  Typography
} from 'antd';
import {
  PlusOutlined,
  EditOutlined,
  DeleteOutlined,
  FolderOutlined,
  InfoCircleOutlined
} from '@ant-design/icons';
import { KnowledgeBaseService, KnowledgeBase, CreateKnowledgeBaseRequest } from '../../services/knowledgeService';

const { Header, Content } = Layout;
const { Title } = Typography;
const { TextArea } = Input;

const KnowledgeBaseList: React.FC = () => {
  const [knowledgeBases, setKnowledgeBases] = useState<KnowledgeBase[]>([]);
  const [loading, setLoading] = useState(false);
  const [createModalVisible, setCreateModalVisible] = useState(false);
  const [editModalVisible, setEditModalVisible] = useState(false);
  const [currentKB, setCurrentKB] = useState<KnowledgeBase | null>(null);
  const [createForm] = Form.useForm();
  const [editForm] = Form.useForm();

  useEffect(() => {
    loadKnowledgeBases();
  }, []);

  const loadKnowledgeBases = async () => {
    setLoading(true);
    try {
      const data = await KnowledgeBaseService.getKnowledgeBases();
      setKnowledgeBases(data);
    } catch (error) {
      message.error('åŠ è½½çŸ¥è¯†åº“å¤±è´¥');
    } finally {
      setLoading(false);
    }
  };

  const handleCreateKnowledgeBase = async (values: CreateKnowledgeBaseRequest) => {
    try {
      await KnowledgeBaseService.createKnowledgeBase(values);
      message.success('çŸ¥è¯†åº“åˆ›å»ºæˆåŠŸ');
      setCreateModalVisible(false);
      createForm.resetFields();
      loadKnowledgeBases();
    } catch (error) {
      message.error('åˆ›å»ºçŸ¥è¯†åº“å¤±è´¥');
    }
  };

  const handleEditKnowledgeBase = async (values: any) => {
    if (!currentKB) return;
    
    try {
      await KnowledgeBaseService.updateKnowledgeBase(currentKB.id, values);
      message.success('çŸ¥è¯†åº“æ›´æ–°æˆåŠŸ');
      setEditModalVisible(false);
      setCurrentKB(null);
      editForm.resetFields();
      loadKnowledgeBases();
    } catch (error) {
      message.error('æ›´æ–°çŸ¥è¯†åº“å¤±è´¥');
    }
  };

  const handleDeleteKnowledgeBase = async (id: string, hardDelete: boolean = false) => {
    try {
      await KnowledgeBaseService.deleteKnowledgeBase(id, hardDelete);
      message.success(hardDelete ? 'çŸ¥è¯†åº“å·²æ°¸ä¹…åˆ é™¤' : 'çŸ¥è¯†åº“å·²åˆ é™¤');
      loadKnowledgeBases();
    } catch (error) {
      message.error('åˆ é™¤çŸ¥è¯†åº“å¤±è´¥');
    }
  };

  const showEditModal = (kb: KnowledgeBase) => {
    setCurrentKB(kb);
    editForm.setFieldsValue({
      name: kb.name,
      description: kb.description,
      status: kb.status
    });
    setEditModalVisible(true);
  };

  const columns = [
    {
      title: 'çŸ¥è¯†åº“åç§°',
      dataIndex: 'name',
      key: 'name',
      render: (name: string, record: KnowledgeBase) => (
        <Space>
          <FolderOutlined />
          <strong>{name}</strong>
        </Space>
      ),
    },
    {
      title: 'æè¿°',
      dataIndex: 'description',
      key: 'description',
      ellipsis: true,
      render: (desc: string) => desc || '-',
    },
    {
      title: 'çŠ¶æ€',
      dataIndex: 'status',
      key: 'status',
      render: (status: string) => {
        const colors = {
          'active': 'green',
          'inactive': 'orange',
          'deleted': 'red'
        };
        const labels = {
          'active': 'æ´»è·ƒ',
          'inactive': 'æœªæ¿€æ´»',
          'deleted': 'å·²åˆ é™¤'
        };
        return <Tag color={colors[status as keyof typeof colors]}>{labels[status as keyof typeof labels]}</Tag>;
      },
    },
    {
      title: 'æ–‡æ¡£æ•°é‡',
      dataIndex: 'document_count',
      key: 'document_count',
      render: (count: number) => count || 0,
    },
    {
      title: 'åˆ›å»ºæ—¶é—´',
      dataIndex: 'created_at',
      key: 'created_at',
      render: (date: string) => new Date(date).toLocaleString(),
    },
    {
      title: 'æ“ä½œ',
      key: 'actions',
      render: (record: KnowledgeBase) => (
        <Space>
          <Button 
            icon={<EditOutlined />} 
            size="small"
            onClick={() => showEditModal(record)}
          >
            ç¼–è¾‘
          </Button>
          <Button 
            icon={<InfoCircleOutlined />} 
            size="small"
            onClick={() => {/* æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ */}}
          >
            ç»Ÿè®¡
          </Button>
          <Popconfirm
            title="ç¡®å®šè¦åˆ é™¤è¿™ä¸ªçŸ¥è¯†åº“å—ï¼Ÿ"
            description="åˆ é™¤åå¯ä»¥åœ¨å›æ”¶ç«™ä¸­æ¢å¤"
            onConfirm={() => handleDeleteKnowledgeBase(record.id, false)}
          >
            <Button danger icon={<DeleteOutlined />} size="small">
              åˆ é™¤
            </Button>
          </Popconfirm>
        </Space>
      ),
    },
  ];

  return (
    <Layout style={{ minHeight: '100vh', background: '#f0f2f5' }}>
      <Header style={{ background: '#fff', padding: '0 24px', boxShadow: '0 1px 4px rgba(0,21,41,.08)' }}>
        <Title level={3} style={{ margin: 0, lineHeight: '64px' }}>çŸ¥è¯†åº“ç®¡ç†</Title>
      </Header>
      <Content style={{ margin: '24px' }}>
        <Card>
          <div style={{ marginBottom: 16 }}>
            <Button 
              type="primary" 
              icon={<PlusOutlined />}
              onClick={() => setCreateModalVisible(true)}
              size="large"
            >
              åˆ›å»ºçŸ¥è¯†åº“
            </Button>
          </div>
          
          <Table
            columns={columns}
            dataSource={knowledgeBases}
            loading={loading}
            rowKey="id"
            pagination={{
              showSizeChanger: true,
              showQuickJumper: true,
              showTotal: (total) => `å…± ${total} ä¸ªçŸ¥è¯†åº“`,
            }}
          />
        </Card>

        {/* åˆ›å»ºçŸ¥è¯†åº“æ¨¡æ€æ¡† */}
        <Modal
          title="åˆ›å»ºçŸ¥è¯†åº“"
          open={createModalVisible}
          onCancel={() => setCreateModalVisible(false)}
          onOk={() => createForm.submit()}
          width={600}
        >
          <Form
            form={createForm}
            layout="vertical"
            onFinish={handleCreateKnowledgeBase}
          >
            <Form.Item
              name="name"
              label="çŸ¥è¯†åº“åç§°"
              rules={[
                { required: true, message: 'è¯·è¾“å…¥çŸ¥è¯†åº“åç§°' },
                { min: 2, max: 50, message: 'åç§°é•¿åº¦åº”åœ¨2-50å­—ç¬¦ä¹‹é—´' }
              ]}
            >
              <Input placeholder="è¾“å…¥çŸ¥è¯†åº“åç§°" />
            </Form.Item>
            <Form.Item
              name="description"
              label="æè¿°"
              rules={[
                { max: 200, message: 'æè¿°ä¸èƒ½è¶…è¿‡200å­—ç¬¦' }
              ]}
            >
              <TextArea 
                placeholder="è¾“å…¥çŸ¥è¯†åº“æè¿°ï¼ˆå¯é€‰ï¼‰" 
                rows={4}
                showCount
                maxLength={200}
              />
            </Form.Item>
          </Form>
        </Modal>

        {/* ç¼–è¾‘çŸ¥è¯†åº“æ¨¡æ€æ¡† */}
        <Modal
          title="ç¼–è¾‘çŸ¥è¯†åº“"
          open={editModalVisible}
          onCancel={() => setEditModalVisible(false)}
          onOk={() => editForm.submit()}
          width={600}
        >
          <Form
            form={editForm}
            layout="vertical"
            onFinish={handleEditKnowledgeBase}
          >
            <Form.Item
              name="name"
              label="çŸ¥è¯†åº“åç§°"
              rules={[
                { required: true, message: 'è¯·è¾“å…¥çŸ¥è¯†åº“åç§°' },
                { min: 2, max: 50, message: 'åç§°é•¿åº¦åº”åœ¨2-50å­—ç¬¦ä¹‹é—´' }
              ]}
            >
              <Input placeholder="è¾“å…¥çŸ¥è¯†åº“åç§°" />
            </Form.Item>
            <Form.Item
              name="description"
              label="æè¿°"
              rules={[
                { max: 200, message: 'æè¿°ä¸èƒ½è¶…è¿‡200å­—ç¬¦' }
              ]}
            >
              <TextArea 
                placeholder="è¾“å…¥çŸ¥è¯†åº“æè¿°ï¼ˆå¯é€‰ï¼‰" 
                rows={4}
                showCount
                maxLength={200}
              />
            </Form.Item>
            <Form.Item
              name="status"
              label="çŠ¶æ€"
            >
              <Select>
                <Select.Option value="active">æ´»è·ƒ</Select.Option>
                <Select.Option value="inactive">æœªæ¿€æ´»</Select.Option>
              </Select>
            </Form.Item>
          </Form>
        </Modal>
      </Content>
    </Layout>
  );
};

export default KnowledgeBaseList;
```

### 4. åˆ›å»ºæ–‡æ¡£ç®¡ç†é¡µé¢

åˆ›å»º `frontend/src/pages/admin/DocumentManagement.tsx`ï¼š
```tsx
import React, { useState } from 'react';
import { Layout, Card, Upload, Button, message, Select, Form } from 'antd';
import { UploadOutlined, InboxOutlined } from '@ant-design/icons';
import { useDropzone } from 'react-dropzone';
import { KnowledgeBaseService } from '../../services/knowledgeService';

const { Content } = Layout;
const { Dragger } = Upload;

interface DocumentManagementProps {
  knowledgeBaseId: string;
}

const DocumentManagement: React.FC<DocumentManagementProps> = ({ knowledgeBaseId }) => {
  const [uploading, setUploading] = useState(false);
  const [form] = Form.useForm();

  const handleFileUpload = async (file: File, docType: string) => {
    setUploading(true);
    try {
      await KnowledgeBaseService.uploadDocument(knowledgeBaseId, file, docType);
      message.success(`æ–‡æ¡£ ${file.name} ä¸Šä¼ æˆåŠŸ`);
    } catch (error) {
      message.error(`æ–‡æ¡£ ${file.name} ä¸Šä¼ å¤±è´¥`);
    } finally {
      setUploading(false);
    }
  };

  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    accept: {
      'application/pdf': ['.pdf'],
      'application/msword': ['.doc'],
      'application/vnd.openxmlformats-officedocument.wordprocessingml.document': ['.docx'],
      'text/plain': ['.txt'],
      'text/markdown': ['.md']
    },
    onDrop: (acceptedFiles) => {
      acceptedFiles.forEach(file => {
        const docType = getDocTypeFromFile(file);
        handleFileUpload(file, docType);
      });
    }
  });

  const getDocTypeFromFile = (file: File): string => {
    const extension = file.name.split('.').pop()?.toLowerCase();
    switch (extension) {
      case 'pdf': return 'pdf';
      case 'doc':
      case 'docx': return 'word';
      case 'txt': return 'txt';
      case 'md': return 'markdown';
      default: return 'txt';
    }
  };

  return (
    <Layout style={{ minHeight: '100vh', background: '#f0f2f5' }}>
      <Content style={{ margin: '24px' }}>
        <Card title="æ–‡æ¡£ä¸Šä¼ ">
          <div 
            {...getRootProps()} 
            style={{
              border: '2px dashed #d9d9d9',
              borderRadius: '6px',
              padding: '40px',
              textAlign: 'center',
              cursor: 'pointer',
              backgroundColor: isDragActive ? '#f0f0f0' : '#fafafa'
            }}
          >
            <input {...getInputProps()} />
            <InboxOutlined style={{ fontSize: '48px', color: '#d9d9d9' }} />
            <p style={{ marginTop: '16px', fontSize: '16px' }}>
              {isDragActive ? 'é‡Šæ”¾æ–‡ä»¶åˆ°æ­¤å¤„' : 'æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶'}
            </p>
            <p style={{ color: '#999' }}>
              æ”¯æŒ PDF, Word, TXT, Markdown æ ¼å¼
            </p>
          </div>
          
          {uploading && (
            <div style={{ marginTop: '16px', textAlign: 'center' }}>
              <span>æ­£åœ¨ä¸Šä¼ æ–‡æ¡£...</span>
            </div>
          )}
        </Card>
      </Content>
    </Layout>
  );
};

export default DocumentManagement;
```

### 5. æ›´æ–°ä¸»åº”ç”¨è·¯ç”±

æ›´æ–° `frontend/src/App.tsx`ï¼š
```tsx
import React from 'react';
import { BrowserRouter as Router, Routes, Route, Link } from 'react-router-dom';
import Chat, { useMessages } from '@chatui/core';
import '@chatui/core/dist/index.css';
import KnowledgeBaseList from './pages/admin/KnowledgeBaseList';
import { Button } from 'antd';
import { SettingOutlined } from '@ant-design/icons';

const App: React.FC = () => {
  const { messages, appendMsg, setTyping } = useMessages([]);

  const handleSend = async (type: string, val: string) => {
    // èŠå¤©é€»è¾‘ä¿æŒä¸å˜
  };

  return (
    <Router>
      <Routes>
        <Route path="/" element={
          <div style={{ height: '100vh' }}>
            <Chat
              navbar={{ 
                title: 'æ™ºèƒ½å®¢æœ',
                rightContent: (
                  <Link to="/admin/knowledge">
                    <Button 
                      type="text" 
                      icon={<SettingOutlined />}
                      style={{ color: '#fff' }}
                    >
                      ç®¡ç†
                    </Button>
                  </Link>
                )
              }}
              messages={messages}
              onSend={handleSend}
              placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."
            />
          </div>
        } />
        <Route path="/admin/knowledge" element={<KnowledgeBaseList />} />
      </Routes>
    </Router>
  );
};

export default App;
```

## âœ… éªŒè¯æ­¥éª¤

### 1. å¯åŠ¨å‰ç«¯æœåŠ¡
```bash
cd frontend
npm start
```

### 2. æµ‹è¯•ç®¡ç†ç•Œé¢
- [ ] è®¿é—® http://localhost:3000/admin/knowledge
- [ ] çŸ¥è¯†åº“åˆ—è¡¨æ­£å¸¸æ˜¾ç¤º
- [ ] åˆ›å»ºçŸ¥è¯†åº“åŠŸèƒ½æ­£å¸¸
- [ ] ç¼–è¾‘çŸ¥è¯†åº“åŠŸèƒ½æ­£å¸¸
- [ ] åˆ é™¤çŸ¥è¯†åº“åŠŸèƒ½æ­£å¸¸

### 3. æµ‹è¯•æ–‡æ¡£ä¸Šä¼ 
- [ ] æ‹–æ‹½æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] æ”¯æŒçš„æ–‡ä»¶æ ¼å¼æ­£ç¡®è¯†åˆ«
- [ ] ä¸Šä¼ è¿›åº¦æ˜¾ç¤ºæ­£å¸¸
- [ ] ä¸Šä¼ æˆåŠŸ/å¤±è´¥æ¶ˆæ¯æ­£ç¡®æ˜¾ç¤º

### 4. æµ‹è¯•ç•Œé¢äº¤äº’
- [ ] è¡¨æ ¼æ’åºå’Œåˆ†é¡µæ­£å¸¸
- [ ] æ¨¡æ€æ¡†æ‰“å¼€å’Œå…³é—­æ­£å¸¸
- [ ] è¡¨å•éªŒè¯æ­£å¸¸å·¥ä½œ
- [ ] å“åº”å¼å¸ƒå±€é€‚é…æ­£å¸¸

## ğŸš¨ å¸¸è§é—®é¢˜

### Ant Designæ ·å¼é—®é¢˜
```tsx
// ç¡®ä¿æ­£ç¡®å¯¼å…¥Ant Designæ ·å¼
import 'antd/dist/reset.css';
```

### è·¯ç”±é…ç½®é—®é¢˜
```tsx
// ç¡®ä¿BrowserRouteræ­£ç¡®é…ç½®
import { BrowserRouter as Router } from 'react-router-dom';
```

### æ–‡ä»¶ä¸Šä¼ é—®é¢˜
```typescript
// æ£€æŸ¥æ–‡ä»¶ç±»å‹å’Œå¤§å°é™åˆ¶
const isValidFile = (file: File) => {
  const validTypes = ['pdf', 'doc', 'docx', 'txt', 'md'];
  const extension = file.name.split('.').pop()?.toLowerCase();
  return validTypes.includes(extension || '');
};
```

## â¡ï¸ ä¸‹ä¸€æ­¥
ç®¡ç†ç•Œé¢å®Œæˆåï¼Œç»§ç»­ [åŠŸèƒ½æµ‹è¯•](./åŠŸèƒ½æµ‹è¯•.md)